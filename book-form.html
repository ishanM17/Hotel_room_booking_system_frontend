<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOk</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            background: url('./images/win.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .title {
            font-size: 3rem;
            font-weight: bold;
            color: black;
            text-align: center;
            margin-top: 2rem;
            transition: transform 0.2s ease;
        }
        .form {
            max-width: 450px;
            padding: 0px 15px;
        }
        .err
        {
            color: brown;
            font-size: 20px;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <h1 class="title">Book your Rooms</h1>
    <form class="form" method="post" style=" margin: auto; margin-top: 80px;" >
        <div class="form-floating">
            <input type="text" class="form-control" id="name" placeholder="name" name="fName" required>
            <label>Name</label>
            <span class="err" id="n_error"></span>
        </div>
        <div class="form-floating">
            <input type="email" class="form-control" id="email" placeholder="email" name="email" required>
            <label for="floatingInput">Email address</label>
            <span class="err" id="e_error"></span>

        </div>
        <div class="form-floating">
            <input type="text" class="form-control" id="mob" placeholder="mob" name="mob" required>
            <label for="floatingPassword">Mobile Number</label>
            <span class="err" id="mob_error"></span>
        </div>
        <div class="form-floating">
            <select class="form-select" id="room-type" aria-label="Default select example">
                <option value="executive">Executive</option>
                <option value="deluxe">Deluxe</option>
                <option value="luxury">Luxury</option>
            </select>
        </div>
        <div class="form-floating">
            <input type="number" class="form-control" id="num" placeholder="num" value="1" name="num" min="1" max="20" required>
            <label for="floatingPassword">number of Rooms</label>
            <span class="err" id="num_error"></span>
        </div>
        <div class="form-floating">
            <input type="date" class="form-control" id="checkin" placeholder="checkin" name="checkin" required>
            <label for="floatingPassword">Checkin Date</label>
            <span class="err" id="in_error"></span>
        </div>
        <div class="form-floating">
            <input type="date" class="form-control" id="checkout" placeholder="checkOut" name="checkout" required>
            <label for="floatingPassword">CheckOut Date</label>
            <span class="err" id="out_error"></span>
        </div>
    </form>
    <div style="text-align: center; margin-top: 30px;">
        <button id="check" class=" btn  btn-success" onclick=findprice() style=" padding: 10px;">Check
            price & availablity</button>
    </div>
    
    <div style="margin: 30px 50px ; text-align: center;">
        <div id="total"
            style="font-size: 40px; margin-left: auto; display: inline; border-radius: 10px;">
        </div>
    </div>
    <div style="text-align: center; margin-top: 30px;">
        <button id="submit" class="btn btn-primary" onclick=confirm()
        style=" padding: 10px; border-radius: 10px;display: none; margin: auto;">confirm Booking </button>
    </div>
    
    <script>
        function findprice()
        {
            let valid = true;
            const prices = {
                "executive": 3500,
                "deluxe": 4500,
                "luxury": 5000
            }
			const name = document.getElementById("name").value;
			const email = document.getElementById("email").value;
			const mob = document.getElementById("mob").value;
            const room_type = document.getElementById("room-type").value;
            const number_of_room  = document.getElementById("num").value
            const checkin = document.getElementById("checkin").value;
            const checkout = document.getElementById("checkout").value;

			const name_p = /^[a-z A-Z]+$/;
			if (!name.match(name_p)) {
				document.getElementById("n_error").innerHTML = "enter a valid name";
				valid = false;
			}

			check = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,3}))$/;
			if (email.match(check)) {
				document.getElementById("e_error").innerHTML = "";
			}
			else {
				document.getElementById("e_error").innerHTML = "enter a valid email";
				valid = false;
			}

			var mob_check = /^[0-9]{10}$/;
			if (!mob.match(mob_check)) {
				document.getElementById("mob_error").innerHTML = "enter a valid mobile number"
				valid = false;
			}
            if(checkin === "")
            {
                document.getElementById("in_error").innerHTML = "select checkin date"
                valid = false
            }
            if(checkout === "")
            {
                document.getElementById("out_error").innerHTML = "select checkout date"
                valid = false
            }
            if(valid)
            {
                const room = document.getElementById("num").value;
                console.log(room);
                const date1 = new Date(document.getElementById("checkin").value);
                const date2 = new Date(document.getElementById("checkout").value);
                console.log(date1.getTime() + "   " + date2.getTime());

                var diff = (date2 - date1)/86400000 ;
                var tol = 4500 * room * diff;
                document.getElementById("total").innerHTML = "Total Amount : " + tol;
                document.getElementById("total").style.color = "red";
                document.getElementById("check").style.display = "none";
                document.getElementById("submit").style.display = "block";
            }
        }

        function confirm(){

            const name = document.getElementById("name").value;
			const email = document.getElementById("email").value;
			const mob = document.getElementById("mob").value;
            const room_type = document.getElementById("room-type").value;
            const number_of_room  = document.getElementById("num").value
            const checkin = document.getElementById("checkin").value;
            const checkout = document.getElementById("checkout").value;

            let booking = {
                "name": name,
                "email": email,
                "mobile": mob,
                "room_type": room_type,
                "num_of_rooms": 2,
                "checkin": checkin,
                "checkout": checkout
            }

            fetch('http://localhost:3000/book/post', {
                method: 'POST',
                body: JSON.stringify(booking),
                headers: {
                    'Content-type': 'application/json; charset=UTF-8'
                }
            })
                .then((response) => response.json())
                .then((json) => {
                    console.log(json);
                    if(json.message === 'Room has been booked'){
                        location.href = './mybooking.html';
                    }
            });
        }
    </script>
</body>
</html>